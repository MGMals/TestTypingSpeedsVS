@page "/typing"


<PageTitle>Typing</PageTitle>

<h1>Typing Test</h1>

<p role="status">Typing Test</p>

<div class="typing-page">

    @if (!IsTestActive)
    {
        <div class="setup-form">
            <div class="form-group">
                <label>Select Time</label>
                <select @bind="SelectedTimeOption">
                    <option value="30">30 Seconds</option>
                    <option value="60">1 Minute</option>
                </select>
            </div>

            <div class="form-group">
                <label>Select Difficulty</label>
                <select @bind="SelectedDifficulty">
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard">Hard</option>
                </select>
            </div>

            <button class="start-btn" @onclick="async () => await StartTest()">Start Test</button>
        </div>
    }
    else
    {
        <div class="test-form">
            <div class="test-info">
                <div>Time Remaining: @SecondsLeft</div>
                <div>Difficulty: @SelectedDifficulty</div>
            </div>

            <div class="lines-area">
                @for (int i = 0; i < Lines.Count; i++)
                {
                    <div class="line-pair">

                        <div class="target-line">@Lines[i]</div>

                        @if (IsFinished)
                        {
                            <div class="typed-line">@GetTypedForLine(i)</div>
                        }
                        else if (i < CurrentLineIndex)
                        {
                            <div class="typed-line">@GetTypedForLine(i)</div>
                        }
                        else if (i == CurrentLineIndex)
                        {
                            <input class="typing-line-input"
                                   @ref="CurrentInputRef"
                                   value="@CurrentTyped"
                                   @oninput="OnCurrentInput"
                                   @onkeydown="OnKeyDown"
                                   disabled="@IsFinished"
                                   autocomplete="off"
                                   autocorrect="off"
                                   autocapitalize="off"
                                   spellcheck="false" />
                        }
                        else
                        {
                            <div class="input-placeholder-line"></div>
                        }
                    </div>
                }
            </div>

            <div class="test-buttons">
                <button @onclick="ResetTest">Reset</button>
                <button @onclick="BackToSetup">Back</button>
            </div>

            @if (IsFinished)
            {
                <div class="results">
                    <div>WPM: @Wpm</div>
                    <div>Accuracy: @Accuracy%</div>
                    <div>Correct Characters: @CorrectChars / @TotalTypedChars</div>
                </div>
            }
        </div>
    }

</div>